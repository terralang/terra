name: CI
on: [push]

jobs:
  check_format:
    name: Check Format
    runs-on: ubuntu-16.04
    steps:
      - uses: actions/checkout@v1
      - run: ./travis.sh
        env:
          CHECK_CLANG_FORMAT: 1
  gcc:
    name: Linux GCC
    runs-on: ubuntu-16.04
    strategy:
      matrix:
        llvm: ['3.5', '3.8', '5.0', '6.0', '7', '8', '9']
        cmake: ['0', '1']
        cuda: ['0']
        exclude:
          - llvm: '3.5'
            cmake: '1'
          - llvm: '5.0'
            cmake: '0'
          - llvm: '7'
            cmake: '0'
        include:
          - llvm: '6.0'
            cmake: '0'
            cuda: '1'
          - llvm: '6.0'
            cmake: '1'
            cuda: '1'
    steps:
      - uses: actions/checkout@v1
      - run: ./travis.sh
        env:
          LLVM_CONFIG: llvm-config-${{ matrix.llvm }}
          CLANG: clang-${{ matrix.llvm }}
          USE_CMAKE: ${{ matrix.cmake }}
          USE_CUDA: ${{ matrix.cuda }}
  # gcc_cmake_cuda:
  #   name: Ubuntu 16.04 GCC CMake CUDA
  #   runs-on: ubuntu-16.04
  #   strategy:
  #     matrix:
  #       llvm: ['6.0', '9']
  #   steps:
  #     - uses: actions/checkout@v1
  #     - run: ./travis.sh
  #       env:
  #         LLVM_CONFIG: llvm-config-${{ matrix.llvm }}
  #         CLANG: clang-${{ matrix.llvm }}
  #         USE_CMAKE: 1
  #         USE_CUDA: 1
  # gcc_cmake_no_static:
  #   name: Ubuntu 16.04 GCC CMake STATIC=0
  #   runs-on: ubuntu-16.04
  #   strategy:
  #     matrix:
  #       llvm: ['6.0', '9']
  #   steps:
  #     - uses: actions/checkout@v1
  #     - run: ./travis.sh
  #       env:
  #         LLVM_CONFIG: llvm-config-${{ matrix.llvm }}
  #         CLANG: clang-${{ matrix.llvm }}
  #         USE_CMAKE: 1
  #         STATIC_LLVM: 0
  #         STATIC_LUAJIT: 0
  # llvm60_cmake_no_slib_include:
  #   name: Ubuntu 16.04 LLVM 6.0 GCC CMake SLIB_INCLUDE=0
  #   runs-on: ubuntu-16.04
  #   strategy:
  #     matrix:
  #       llvm: ['6.0', '9']
  #   steps:
  #     - uses: actions/checkout@v1
  #     - run: ./travis.sh
  #       env:
  #         LLVM_CONFIG: llvm-config-${{ matrix.llvm }}
  #         CLANG: clang-${{ matrix.llvm }}
  #         USE_CMAKE: 1
  #         SLIB_INCLUDE_LLVM: 0
  #         SLIB_INCLUDE_LUAJIT: 0
  # llvm60_cmake_luajit:
  #   name: Ubuntu 16.04 LLVM 6.0 GCC CMake Moonjit
  #   runs-on: ubuntu-16.04
  #   strategy:
  #     matrix:
  #       llvm: ['9']
  #       luajit: [moonjit, luajit]
  #   steps:
  #     - uses: actions/checkout@v1
  #     - run: ./travis.sh
  #       env:
  #         LLVM_CONFIG: llvm-config-${{ matrix.llvm }}
  #         CLANG: clang-${{ matrix.llvm }}
  #         USE_CMAKE: 1
  #         TERRA_LUA: ${{ matrix.luajit }}
  docker:
    name: Docker
    runs-on: ubuntu-latest
    strategy:
      matrix:
        distro: [ubuntu-16.04, ubuntu-18.04, ubuntu-20.04]
    steps:
      - uses: actions/checkout@v1
      - run: ./travis.sh
        env:
          DOCKER_BUILD: ${{ matrix.distro }}
  macos_llvm6:
    name: macOS LLVM 6
    runs-on: macos-10.15
    steps:
      - uses: actions/checkout@v1
      - run: ./travis.sh
        env:
          LLVM_CONFIG: llvm-config-6.0
          CLANG: clang-6.0
          USE_CMAKE: 1
